<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>äº¬ç¾ï½œå°ˆå±¬å„ªæƒ ç™»è¨˜</title>
  <link rel="preconnect" href="https://static.line-scdn.net">
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    :root{
      --brand:#06C755; /* LINE ç¶ ï¼Œå¯æ›æˆä½ çš„å“ç‰Œè‰² */
      --ink:#111827; --muted:#6B7280; --bg:#F6F7F9; --white:#fff;
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", Arial, "PingFang TC", "Microsoft JhengHei", sans-serif;color:var(--ink)}
    .wrap{min-height:100dvh;display:grid;place-items:center;padding:24px}
    .card{
      width:min(720px,100%); background:var(--white); border-radius:var(--radius);
      box-shadow: 0 10px 30px rgba(16,24,40,.12); padding:24px 20px; animation:pop .25s ease-out
    }
    @keyframes pop{from{transform:translateY(8px);opacity:0} to{transform:none;opacity:1}}
    header{display:flex;align-items:center;gap:12px;margin-bottom:14px}
    .logo{width:36px;height:36px;border-radius:12px;background:var(--brand)}
    h1{font-size:20px;margin:0}
    .sub{color:var(--muted);font-size:14px}
    form{display:grid;gap:14px;margin-top:8px}
    .row{display:grid;gap:8px}
    label{font-weight:600;font-size:14px}
    input,select,textarea{
      width:100%; padding:14px 12px; border:1px solid #E5E7EB; border-radius:12px; background:#fff; font-size:16px;
      outline:none; transition:border .15s, box-shadow .15s
    }
    input:focus,select:focus,textarea:focus{border-color:#cbd5e1; box-shadow:0 0 0 4px rgba(6,199,85,.08)}
    .muted{color:var(--muted); font-size:13px}
    .pill{
      display:inline-grid;grid-auto-flow:column;gap:8px;align-items:center;justify-content:center;
      padding:14px 16px;border-radius:999px;background:var(--brand);color:#fff;font-weight:700;
      cursor:pointer;border:none;font-size:16px;transition:transform .05s ease;
    }
    .pill:active{transform:translateY(1px)}
    .hidden{display:none}
    .success{
      text-align:center; padding:24px 10px
    }
    .success h2{margin:8px 0 6px 0}
    .badge{
      display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#E9FBF0;color:#065f46;font-weight:600;font-size:14px
    }
  </style>
</head>
<body>
  <div class="wrap">
    <main class="card" id="card">
      <header>
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>äº¬ç¾ï½œå°ˆå±¬å„ªæƒ ç™»è¨˜</h1>
          <div class="sub">å¹¾ç§’å®Œæˆï¼Œç«‹å³å»ºç«‹ä½ çš„å„ªæƒ åå–®</div>
        </div>
      </header>

      <div class="row muted" id="hello">è¼‰å…¥ä¸­â€¦</div>

      <form id="form">
        <input type="hidden" name="lineUserId" id="lineUserId" />
        <input type="hidden" name="lineDisplayName" id="lineDisplayName" />

        <div class="row">
          <label for="phone">è¯çµ¡é›»è©±</label>
          <input id="phone" name="phone" inputmode="tel" placeholder="è«‹è¼¸å…¥æ‰‹æ©Ÿè™Ÿç¢¼" required />
        </div>

        <div class="row">
          <label for="interest">æƒ³äº†è§£çš„ç”¢å“</label>
          <select id="interest" name="interest" required>
            <option value="" selected disabled>è«‹é¸æ“‡</option>
            <option>è­·å…· / é‹å‹•æ”¯æ’</option>
            <option>æ©Ÿèƒ½æœé£¾</option>
            <option>èˆ’ç·©èˆ‡ä¿å¥</option>
            <option>å…¶ä»–</option>
          </select>
        </div>

        <div class="row">
          <label for="note">å‚™è¨»ï¼ˆé¸å¡«ï¼‰</label>
          <textarea id="note" name="note" rows="3" placeholder="æƒ³å°æˆ‘å€‘èªªçš„è©±ã€å°ºå¯¸ã€ä½¿ç”¨æƒ…å¢ƒç­‰"></textarea>
          <div class="muted">é€å‡ºå¾Œï¼Œæˆ‘å€‘æœƒä»¥ LINE æ¨é€å›è¦†ä½ ã€‚</div>
        </div>

        <button type="submit" class="pill">é€å‡ºè³‡æ–™ä¸¦åŠ å…¥å„ªæƒ åå–®</button>
      </form>

      <section id="done" class="success hidden">
        <div class="badge">ğŸ‰ é€å‡ºæˆåŠŸ</div>
        <h2>æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„éœ€æ±‚</h2>
        <p class="muted">å¾ŒçºŒå°‡é€é LINE å‚³é€å„ªæƒ èˆ‡å›è¦†çµ¦æ‚¨ï¼Œæ•¬è«‹ç•™æ„ã€‚</p>
      </section>
    </main>
  </div>

  <script>
    const LIFF_ID = "2007890962-PDQk9qOl"; // â† ä½ çš„ LIFF ID
    const N8N_WEBHOOK_URL = "https://YOUR-N8N-HOSTING/webhook/your-route"; // â† æ›æˆä½ çš„ n8n webhook

    const els = {
      hello: document.getElementById('hello'),
      form: document.getElementById('form'),
      done: document.getElementById('done'),
      card: document.getElementById('card'),
      lineUserId: document.getElementById('lineUserId'),
      lineDisplayName: document.getElementById('lineDisplayName')
    };

    async function bootstrap() {
      try {
        await liff.init({ liffId: LIFF_ID });

        if (!liff.isLoggedIn()) {
          liff.login();
          return;
        }

        const profile = await liff.getProfile();
        els.hello.textContent = `ğŸ‘‹ æ­¡è¿å›ä¾†ï¼Œ${profile.displayName}`;
        els.lineUserId.value = profile.userId || '';
        els.lineDisplayName.value = profile.displayName || '';

      } catch (e) {
        console.error(e);
        els.hello.textContent = "âš ï¸ LIFF åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹åœ¨ LINE å…§é‡æ–°é–‹å•Ÿã€‚";
      }
    }

    async function postToN8N(payload){
      const res = await fetch(N8N_WEBHOOK_URL, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify(payload)
      });
      if (!res.ok) throw new Error("n8n webhook error");
      return res.json().catch(()=> ({}));
    }

    els.form.addEventListener('submit', async (ev) => {
      ev.preventDefault();

      const payload = {
        lineUserId: els.lineUserId.value,
        lineDisplayName: els.lineDisplayName.value,
        phone: document.getElementById('phone').value.trim(),
        interest: document.getElementById('interest').value,
        note: document.getElementById('note').value.trim(),
        ts: new Date().toISOString(),
        source: "liff-äº¬ç¾-å„ªæƒ ç™»è¨˜"
      };

      try {
        await postToN8N(payload);

        // å›è¦†ç”¨æˆ¶ä¸€å‰‡è¨Šæ¯ï¼ˆéœ€å‹¾ chat_message.writeï¼‰
        if (liff.isInClient()) {
          await liff.sendMessages([{
            type: "text",
            text: "å·²å®Œæˆç™»è¨˜ âœ… æˆ‘å€‘æœƒç›¡å¿«å›è¦†ä¸¦æä¾›å°ˆå±¬å„ªæƒ ã€‚"
          }]);
        }

        // é¡¯ç¤ºæˆåŠŸç•«é¢
        els.form.classList.add('hidden');
        els.done.classList.remove('hidden');

        // 3 ç§’å¾Œè‡ªå‹•é—œé–‰ï¼ˆåœ¨ LINE å…§ï¼‰
        setTimeout(() => { if (liff.isInClient()) liff.closeWindow(); }, 3000);

      } catch (err) {
        console.error(err);
        alert("é€å‡ºå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–ç›´æ¥åœ¨èŠå¤©å®¤ç•™è¨€çµ¦æˆ‘å€‘ã€‚");
      }
    });

    bootstrap();
  </script>
</body>
</html>
